/*
 * pruebaServidor.c
 *
 *  Created on: 11/9/2015
 *      Author: utnso
 */

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <netdb.h>
#include <unistd.h>
#include <libSockets.h>

#define PUERTO "6667"
#define BACKLOG 5
#define PACKAGESIZE 1024





typedef enum identificadores {
	correr = 0, hola = 1
} Identidicadores;

int main() {


	int socketCliente;
	socketCliente = conectarSocketServidor(PUERTO, BACKLOG);

	int status = 1;

	printf("Cliente conectado. Esperando mensajes:\n");

	while (status != 0) {
		Paquete paq;
		status = recv(socketCliente, &paq.longitud_id, sizeof(int), 0);
		paq.id = malloc(paq.longitud_id);


		if (status != 0) {
			printf("El tamaño del id enviado es: %d\n", paq.longitud_id);
			recv(socketCliente,paq.id,paq.longitud_id,0);
			printf("El id que mandaste es: %s\n", paq.id);
			recv(socketCliente, &paq.longitud_mensaje, sizeof(int), 0);
			printf("tamaño del mensaje a leer: %d\n", paq.longitud_mensaje);
			paq.mensaje = malloc(paq.longitud_mensaje);
			recv(socketCliente, paq.mensaje, paq.longitud_mensaje, 0);
			printf("El mensaje es:%s\n", paq.mensaje);

			free(paq.mensaje);

		}
		free(paq.id);



	}

	close(socketCliente);

	return 0;
}

