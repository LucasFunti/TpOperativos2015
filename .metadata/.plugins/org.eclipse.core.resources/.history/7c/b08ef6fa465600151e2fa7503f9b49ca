/*
 * protocolo.c
 *
 *  Created on: 8/9/2015
 *      Author: utnso
 */

#include <stdio.h>
#include <stdlib.h>

typedef struct protocolo {
	int identificador;
	int cantidadBytes;
} Protocolo;

typedef enum identificadores {
	iniciar = 0,
	correr = 99,
	leer = 1,
	escribir = 2,
	entradaSalida = 3,
	finalizar = 4
} Identificadores;



void leerMensaje(int socket, int *identificador, int **mensaje) {
	Protocolo cabecera;
	*mensaje = NULL;

	recv(socket, &cabecera, sizeof(cabecera), 0); /* Se lee la cabecera */

	/* Rellenamos el identificador para devolverlo */
	*identificador = cabecera.identificador;

	/* Si hay que leer una estructura detrÃ¡s */
	if (cabecera.cantidadBytes > 0) {
		*mensaje = (char *) malloc(cabecera.cantidadBytes); /* Se reserva espacio para leer el mensaje */
		recv(socket, *mensaje, cabecera.cantidadBytes, 0);
	}
}

