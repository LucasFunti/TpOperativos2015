/*
 * pruebaServidor.c
 *
 *  Created on: 11/9/2015
 *      Author: utnso
 */

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <netdb.h>
#include <unistd.h>
#include <libSockets.h>

#define PUERTO "6667"
#define BACKLOG 5
#define PACKAGESIZE 1024

typedef struct Protocolo {
	char id[7];
	char mensaje[10];
} Protocolo;

typedef enum identificadores {
	correr = 0
} Identidicadores;


int main() {

	int socketCliente;
	socketCliente = conectarSocketServidor(PUERTO, BACKLOG);

	int status = 1;

	printf("Cliente conectado. Esperando mensajes:\n");

	while (status != 0) {
		/*int *identificador = malloc(sizeof(int));*/
		size_t cantMensaje;
		char *identificador = malloc(sizeof(int));
		status = recv(socketCliente, identificador, sizeof(int), 0);

		if (status != 0) {
			printf("El id que mandaste es: %s\n", identificador);
			recv(socketCliente, &cantMensaje, sizeof(int), 0);
			printf("tama√±o del mensaje a leer: %d\n",cantMensaje);
			char *mensaje = malloc(cantMensaje);
			recv(socketCliente, mensaje, cantMensaje, 0);
			printf("El mensaje es:%s\n", mensaje);
		}
	}



close( socketCliente);

return 0;
}

